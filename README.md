# citilink-autotests
citilink-autotest - это тестовый фреймворк для авто-тестирования сайта “Citilink” на основе фреймворка Selenium (Python).

## Особенности 
Проект сделан на основе фреймворка Selenium на языке Python и представляет собой совокупность файлов, которые разбиты по следующим директориям:         
- base
- pages
- screen
- tests
- utilities
- отдельно стоящий файл conftest.py

### base
В директории **base** располагается единственный файл base_class.py, в котором содержится описание класса Base, который имеет общие для всех классов методы. От данного класса наследуются все другие классы в папке _pages_.

### pages
В директории pages располагаются файлы, которые соответствуют классам страниц, а именно: main_page.py, laptops_page.py, product_page.py, cart_page.py, checkout_page.py и shop_choice_page.py, которым соответствуют классы MainPage, LaptopsPage, ProductPage, CartPage, CheckoutPage и ShopChoicePage соответственно.

Каждый из этих классов соответствует определенной странице, которую открывает пользователь на пути к оформлению заказа. У каждой страницы имеются свои уникальные локаторы, методы, действия, переменные и т.д.


Всего классы директории pages имеют 5 типов данных:
- Переменные
- Локаторы (Locators)
- Геттеры (Getters)
- Действия (Actions)
- Методы (Methods)

Разберем каждый поподробнее, взяв для примера класс **MainPage**.

1. **Переменные** (например, цена ноутбука - laptop_price)


2. **Локаторы** (Locators)  
    Локатор представляет собой адрес элемента на экране, например:
    ```
    catalog_locator = '//button[@data-meta-name="DesktopHeaderFixed__catalog-menu"]'
    ```
    Данный локатор является адресом кнопки “Каталог” на главной странице сайта Citilink.


3. **Геттеры** (Getters)  
    Getters возвращают обращение к элементу по определенному локатору. Например, следующая строчка возвращает обращение к элементу с локатором “catalog_locator”.
    ```
    def get_catalog(self):
        return WebDriverWait(self.driver,10) \
    .until(EC.element_to_be_clickable((By.XPATH, self.catalog_locator)))
    ```
    Также большинство Геттеров в проекте используют явное ожидание, как в примере, приведенном выше.


4. **Действия** (Actions)  
    Actions представляют собой простейшие действия, которые можно сделать с элементом, например, кликнуть на него, навести курсор мыши, вернуть значение текста и т.д. Все Actions в проекте построены так – вызывается функция-геттер определенного элемента и выполняется действие над ним:
    ```
    def catalog_click(self):
        self.get_catalog().click()
    ```
    Например, в данном случае мы вызываем геттер кнопки “Каталог” и выполняем клик.

5. **Методы** (Methods)  
    Методы в данном проекте чаще всего представляют собой совокупность действий (Actions). Например:
    ```
    def choose_laptops(self):
        with step("Choose section with laptops"):
            self.catalog_click()
            self.laptops_and_pc_move_to()
            self.laptops_click()
    ```
    Метод “choose_laptops” состоит из действий “catalog_click” (клик по кнопке Каталог), “ laptops_and_pc_move_to” (наводка курсора мыши на элемент “Ноутбуки и ПК”) и  “laptops_click” (клик по кнопке Ноутбуки). Каждое из этих действий в себе также вызывает геттер определенного элемента и выполняет определенное действие над ним.

### test
В данной директории расположены непосредственно сами тесты:  
- test_buy_product.py
- test_price_when_additional_service_added.py
- test_price_when_multiple_copies_of_product_added.py 

Каждый из тестов создает в себе объекты классов определенных страниц, вызывает определенные методы, действия и т.д. – в соответствии с требуемой задачей. 

Рассмотрим подробно каждый из тестов:

1. **test_buy_product**  
Это E2E тест, который эмулирует действия пользователя по покупке товара. Программа открывает сайт Citilink в браузере Chrome, заходит в каталог, выбирает раздел с ноутбуками, устанавливает различные фильтры (процессор, сортировку по отзывам, диапазон цены и т.д.). Затем она кладет первый подходящий по характеристикам ноутбук в корзину и оформляет заказ, заполняя поля с личными данными и выбирая пункт самовывоза. Весь процесс полностью автоматизирован.
В данном тесте проверки (assert) проводятся на разных этапах: например, на этапе нахождения на странице с выбранным ноутбуком (ProductPage) его название и цена сохраняются в соответствующие переменные, которые потом сравниваются с таковыми на этапах корзины (CartPage) и этапе оформления заказа (CheckoutPage). Также в самом конце теста сравнивается итоговая сумма заказа с ценой продукта (т.к. никаких доп.услуг не покупалась, их цена должна совпадать)

2. **test_price_when_additional_service_added**  
Данный тест – модульный, в нем тестируется правильность подсчета суммы заказа при выборе дополнительных услуг. На этапе нахождения в корзине выбирается 1-я добавочная услуга и выполняется assert – совпадает ли итоговая сумма заказа с ценой ноутбука + цена добавочной услуги? Если да – тест считается выполненным успешно

3. **test_price_when_multiple_copies_of_product_added**  
Данный тест также является модульным, в нем тестируется правильность подсчета суммы заказа при выборе нескольких (2-10, выбирается рандомно) одинаковых товаров. По сути, производится подсчет – равна ли итоговая сумма заказа стоимости одного товара, умноженного на кол-во товара? Если да – тест считается пройденным.

### screen
В данной директории хранятся все сделанные в проекте скриншоты. По умолчанию папка пустая, однако в любой момент в тесте вы можете создать объект любого класса и из него вызывать метод screenshot, находящийся в классе-родителе Base, чтобы сделать скриншот определенного этапа.

Файл **conftest.py** – благодаря нему перед каждым тестом выводится надпись “TEST HAS BEEN STARTED”, а в конце каждого теста – “TEST HAS BEEN ENDED”. Данный параметр можно изменить, изменив параметр fixture в conftest.


## Getting started

Для запуска проекта требуется:
1. Выполнить clone проекта
2. Установить в IDE следующие пакеты: selenium, pytest, allure-pytest, assertpy
3. Скачать драйвер для текущей версии вашего браузера Chrome по ссылке https://chromedriver.chromium.org/
4. Распаковать данный драйвер в директорию проекта вашей IDE
5. Запустить файлы из папки **tests** (или один из них на выбор)

Чтобы запустить тесты через pytest и иметь возможность просмотреть отчет об их прохождении в Allure, необходимо ввести следующую команду в терминал:
```
python -m pytest --alluredir=test_results/ tests/
```
В конце данной команды при желании можно указать конкретный тест, например:
```
python -m pytest --alluredir=test_results/ tests/test_buy_product.py
```
Чтобы просмотреть отчет о прохождении тестов в Allure, после прохождения тестов введите в терминал следующую команду:
```
allure serve test_results/  
```
